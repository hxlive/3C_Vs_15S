<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸‰ç‚®å¤§æˆ˜åäº”å…µ-hxliveç‰ˆ</title>
  <style>
    body {
      background: linear-gradient(to bottom, #e5e7eb, #F5F5DC);
      font-family: sans-serif;
      min-height: 100vh;
    }
    canvas {
      border: 2px solid #4B5EAA;
      background-color: #F5F5DC;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .æ¸¸æˆå®¹å™¨ {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      font-size: 36px;
      font-weight: 800;
      color: #4f46e5;
      margin-bottom: 24px;
    }
    #æ¸¸æˆçŠ¶æ€ {
      margin-top: 24px;
      font-size: 36px;
      font-weight: 600;
      font-family: Georgia, serif;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      opacity: 0;
      animation: æ·¡å…¥ 0.5s forwards;
    }
    .å›åˆ-ç™½æ£‹ {
      color: #FFFFFF;
      text-shadow: 0 0 2px #000000;
    }
    .å›åˆ-é»‘æ£‹ {
      color: #1a1a1a;
    }
    .èƒœè´Ÿæç¤º-èƒœåˆ© {
      color: #10B981;
    }
    .èƒœè´Ÿæç¤º-å¤±è´¥ {
      color: #EF4444;
    }
    .AIæ€è€ƒä¸­ {
      color: #F59E0B;
    }
    .æŒ‰é’®ç»„ {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
    }
    button {
      background-color: #4f46e5;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: none;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.3s;
    }
    button:hover {
      background-color: #4338ca;
      transform: scale(1.1);
    }
    button:disabled {
      background-color: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }
    .è§„åˆ™è¯´æ˜ {
      max-width: 600px;
      margin: 24px auto;
      padding: 0 20px;
      color: #666666;
    }
    .è§„åˆ™è¯´æ˜ h2 {
      font-size: 24px;
      font-weight: 700;
      color: #4f46e5;
      margin-bottom: 16px;
    }
    .è§„åˆ™è¯´æ˜ p {
      font-size: 16px;
      line-height: 1.5em;
    }
    .è§„åˆ™è¯´æ˜ ul {
      list-style-type: disc;
      padding-left: 20px;
      margin: 8px 0;
    }
    .è§„åˆ™è¯´æ˜ li {
      margin-bottom: 8px;
    }
    #èƒœè´Ÿæ¨¡æ€ {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, #F5F5DC, #374151);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      animation: æ·¡å…¥ 0.5s forwards;
    }
    #èƒœè´Ÿæ¨¡æ€.æ˜¾ç¤º {
      display: flex;
    }
    #èƒœè´Ÿå®¹å™¨ {
      background: #FFFFFF;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 600px;
      width: 90%;
    }
    #èƒœè´Ÿå®¹å™¨.èƒœåˆ© {
      border: 2px solid #10B981;
    }
    #èƒœè´Ÿå®¹å™¨.å¤±è´¥ {
      border: 2px solid #EF4444;
    }
    #èƒœè´Ÿæ–‡æœ¬ {
      font-family: Georgia, serif;
      font-weight: 800;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }
    #èƒœè´Ÿæ–‡æœ¬.èƒœåˆ© {
      color: #10B981;
      font-size: 48px;
    }
    #èƒœè´Ÿæ–‡æœ¬.å¤±è´¥ {
      color: #EF4444;
      font-size: 42px;
    }
    #é‡ç©æŒ‰é’® {
      background-color: #4f46e5;
      padding: 12px 24px;
      font-size: 18px;
      opacity: 0;
      animation: æ·¡å…¥ 0.5s 0.2s forwards;
    }
    .æ£‹ç›˜-èƒœåˆ© {
      animation: è¾¹æ¡†é—ªçƒèƒœåˆ© 2s infinite;
      opacity: 0;
      animation: æ·¡å…¥ 0.5s forwards, è¾¹æ¡†é—ªçƒèƒœåˆ© 2s infinite;
    }
    .æ£‹ç›˜-å¤±è´¥ {
      animation: è¾¹æ¡†é—ªçƒå¤±è´¥ 2s infinite;
      opacity: 0;
      animation: æ·¡å…¥ 0.5s forwards, è¾¹æ¡†é—ªçƒå¤±è´¥ 2s infinite;
    }
    @keyframes è¾¹æ¡†é—ªçƒèƒœåˆ© {
      0% { border-color: #4B5EAA; }
      50% { border-color: #34D399; }
      100% { border-color: #4B5EAA; }
    }
    @keyframes è¾¹æ¡†é—ªçƒå¤±è´¥ {
      0% { border-color: #4B5EAA; }
      50% { border-color: #F87171; }
      100% { border-color: #4B5EAA; }
    }
    @keyframes æ·¡å…¥ {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @media (max-width: 600px) {
      canvas {
        width: 300px;
        height: 300px;
      }
      button, #é‡ç©æŒ‰é’® {
        padding: 8px 16px;
        font-size: 14px;
      }
      #æ¸¸æˆçŠ¶æ€ {
        font-size: 28px;
      }
      #èƒœè´Ÿå®¹å™¨ {
        width: 90%;
      }
      #èƒœè´Ÿæ–‡æœ¬.èƒœåˆ© {
        font-size: 36px;
      }
      #èƒœè´Ÿæ–‡æœ¬.å¤±è´¥ {
        font-size: 32px;
      }
      .è§„åˆ™è¯´æ˜ h2 {
        font-size: 20px;
      }
      .è§„åˆ™è¯´æ˜ p, .è§„åˆ™è¯´æ˜ li {
        font-size: 14px;
      }
    }
    @media (min-width: 600px) and (max-width: 800px) {
      canvas {
        width: 400px;
        height: 400px;
      }
      #èƒœè´Ÿå®¹å™¨ {
        width: 80%;
      }
      #èƒœè´Ÿæ–‡æœ¬.èƒœåˆ© {
        font-size: 42px;
      }
      #èƒœè´Ÿæ–‡æœ¬.å¤±è´¥ {
        font-size: 38px;
      }
    }
  </style>
</head>
<body>
  <div class="æ¸¸æˆå®¹å™¨">
    <h1>ä¸‰ç‚®å¤§æˆ˜åäº”å…µ</h1>
    <canvas id="æ¸¸æˆç”»å¸ƒ" width="500" height="500"></canvas>
    <div id="æ¸¸æˆçŠ¶æ€"></div>
    <div class="æŒ‰é’®ç»„">
      <button id="äººæœºç™½æ£‹æŒ‰é’®">äººæœºå¯¹æˆ˜ï¼ˆæ‰§ç™½æ£‹ï¼‰</button>
      <button id="äººæœºé»‘æ£‹æŒ‰é’®">äººæœºå¯¹æˆ˜ï¼ˆæ‰§é»‘æ£‹ï¼‰</button>
      <button id="åŒäººå¯¹æˆ˜æŒ‰é’®">åŒäººå¯¹æˆ˜</button>
      <button id="é‡ç½®æŒ‰é’®">é‡æ–°å¼€å§‹</button>
    </div>
  </div>
  <div class="è§„åˆ™è¯´æ˜">
    <h2>æ¸¸æˆè§„åˆ™</h2>
    <p>â€œä¸‰ç‚®åäº”å…µâ€æ˜¯ä¸€æ¬¾ç­–ç•¥æ£‹ç±»æ¸¸æˆï¼Œç©å®¶æ§åˆ¶ç™½æ£‹ï¼ˆâ€œç‚®â€ï¼‰æˆ–é»‘æ£‹ï¼ˆâ€œå…µâ€ï¼‰åœ¨ 5x5 æ£‹ç›˜ä¸Šå¯¹æˆ˜ã€‚è§„åˆ™å¦‚ä¸‹ï¼š</p>
    <ul>
      <li><strong>æ£‹ç›˜ä¸æ£‹å­</strong>ï¼š5x5 æ ¼ï¼Œç¼–å· 1-25ã€‚å¼€å±€ 3 ä¸ªç™½æ£‹ï¼ˆâ€œç‚®â€ï¼‰åœ¨æ ¼å­ 22-24ï¼Œ15 ä¸ªé»‘æ£‹ï¼ˆâ€œå…µâ€ï¼‰åœ¨æ ¼å­ 1-15ã€‚</li>
      <li><strong>ç§»åŠ¨è§„åˆ™</strong>ï¼šç™½æ£‹å¯ä¸Šä¸‹å·¦å³ç§»ä¸€æ ¼åˆ°ç©ºä½ï¼Œæˆ–è·³è¿‡ç©ºä½åƒé»‘æ£‹ï¼›é»‘æ£‹åªèƒ½ç§»ä¸€æ ¼åˆ°ç©ºä½ã€‚</li>
      <li><strong>ç›®æ ‡</strong>ï¼šç™½æ£‹éœ€åƒæ‰ 12 ä¸ªæˆ–æ›´å¤šé»‘æ£‹ï¼›é»‘æ£‹éœ€å›°ä½æ‰€æœ‰ç™½æ£‹ï¼Œä½¿å…¶æ— åˆæ³•ç§»åŠ¨ã€‚</li>
      <li><strong>èƒœè´Ÿ</strong>ï¼šç™½æ£‹åƒæ‰ 12 ä¸ªé»‘æ£‹åˆ™èƒœï¼›ç™½æ£‹æ— ç§»åŠ¨åˆ™é»‘æ£‹èƒœï¼›ä¸‰æ¬¡é‡å¤å±€é¢åˆ¤å¹³å±€ã€‚</li>
    </ul>
    <p>é€‰æ‹©â€œäººæœºå¯¹æˆ˜â€æŒ‘æˆ˜ AIï¼Œæˆ–â€œåŒäººå¯¹æˆ˜â€ä¸æœ‹å‹å¯¹å¼ˆï¼</p>
  </div>
  <div id="èƒœè´Ÿæ¨¡æ€">
    <div id="èƒœè´Ÿå®¹å™¨">
      <div id="èƒœè´Ÿæ–‡æœ¬"></div>
      <button id="é‡ç©æŒ‰é’®">å†ç©ä¸€å±€</button>
    </div>
  </div>
  <script>
    const ç”»å¸ƒ = document.getElementById('æ¸¸æˆç”»å¸ƒ');
    const ä¸Šä¸‹æ–‡ = ç”»å¸ƒ.getContext('2d');
    const çŠ¶æ€ = document.getElementById('æ¸¸æˆçŠ¶æ€');
    const é‡ç½®æŒ‰é’® = document.getElementById('é‡ç½®æŒ‰é’®');
    const äººæœºç™½æ£‹æŒ‰é’® = document.getElementById('äººæœºç™½æ£‹æŒ‰é’®');
    const äººæœºé»‘æ£‹æŒ‰é’® = document.getElementById('äººæœºé»‘æ£‹æŒ‰é’®');
    const åŒäººå¯¹æˆ˜æŒ‰é’® = document.getElementById('åŒäººå¯¹æˆ˜æŒ‰é’®');
    const èƒœè´Ÿæ¨¡æ€ = document.getElementById('èƒœè´Ÿæ¨¡æ€');
    const èƒœè´Ÿå®¹å™¨ = document.getElementById('èƒœè´Ÿå®¹å™¨');
    const èƒœè´Ÿæ–‡æœ¬ = document.getElementById('èƒœè´Ÿæ–‡æœ¬');
    const é‡ç©æŒ‰é’® = document.getElementById('é‡ç©æŒ‰é’®');

    const ç½‘æ ¼å¤§å° = 5;
    let æ ¼å­å¤§å° = 0; // åˆå§‹å€¼ä¸º 0
    const é»‘æ£‹ = '#333333';
    const ç™½æ£‹ = '#F5F5F5';

    // éŸ³æ•ˆ
    const éŸ³æ•ˆç¯å¢ƒ = new (window.AudioContext || window.webkitAudioContext)();
    function æ’­æ”¾éŸ³æ•ˆ(é¢‘ç‡å¼€å§‹, é¢‘ç‡ç»“æŸ, æŒç»­æ—¶é—´, éŸ³é‡ = 0.5) {
      const æŒ¯è¡å™¨ = éŸ³æ•ˆç¯å¢ƒ.createOscillator();
      const å¢ç›ŠèŠ‚ç‚¹ = éŸ³æ•ˆç¯å¢ƒ.createGain();
      æŒ¯è¡å™¨.connect(å¢ç›ŠèŠ‚ç‚¹);
      å¢ç›ŠèŠ‚ç‚¹.connect(éŸ³æ•ˆç¯å¢ƒ.destination);
      æŒ¯è¡å™¨.type = 'sine';
      æŒ¯è¡å™¨.frequency.setValueAtTime(é¢‘ç‡å¼€å§‹, éŸ³æ•ˆç¯å¢ƒ.currentTime);
      æŒ¯è¡å™¨.frequency.linearRampToValueAtTime(é¢‘ç‡ç»“æŸ, éŸ³æ•ˆç¯å¢ƒ.currentTime + æŒç»­æ—¶é—´);
      å¢ç›ŠèŠ‚ç‚¹.gain.setValueAtTime(éŸ³é‡, éŸ³æ•ˆç¯å¢ƒ.currentTime);
      æŒ¯è¡å™¨.start();
      æŒ¯è¡å™¨.stop(éŸ³æ•ˆç¯å¢ƒ.currentTime + æŒç»­æ—¶é—´);
    }

    class æ£‹ç›˜ {
      constructor() {
        this.ç½‘æ ¼ = Array(ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å°).fill(null);
        this.å›åˆ = ç™½æ£‹;
        this.é€‰ä¸­æ£‹å­ = null;
        this.åƒæ‰é»‘æ£‹æ•° = 0;
        this.æœ€åç§»åŠ¨ = null;
        this.å†å²å“ˆå¸Œ = [];
        this.å“ˆå¸Œè®¡æ•° = new Map();
      }

      åˆå§‹åŒ–() {
        this.ç½‘æ ¼.fill(null);
        for (let i = 0; i < 15; i++) {
          this.ç½‘æ ¼[i] = é»‘æ£‹;
        }
        for (let i = 21; i <= 23; i++) {
          this.ç½‘æ ¼[i] = ç™½æ£‹;
        }
        this.åƒæ‰é»‘æ£‹æ•° = 0;
        this.å›åˆ = ç™½æ£‹;
        this.é€‰ä¸­æ£‹å­ = null;
        this.æœ€åç§»åŠ¨ = null;
        this.å†å²å“ˆå¸Œ = [];
        this.å“ˆå¸Œè®¡æ•°.clear();
      }

      è·å–åˆæ³•ç§»åŠ¨(pos) {
        const ç§»åŠ¨ = [];
        const æ–¹å‘ = [
          { è¡Œå˜åŒ–: -1, åˆ—å˜åŒ–: 0 }, // ä¸Š
          { è¡Œå˜åŒ–: 1, åˆ—å˜åŒ–: 0 },  // ä¸‹
          { è¡Œå˜åŒ–: 0, åˆ—å˜åŒ–: -1 }, // å·¦
          { è¡Œå˜åŒ–: 0, åˆ—å˜åŒ–: 1 }   // å³
        ];
        const è¡Œ = Math.floor(pos / ç½‘æ ¼å¤§å°);
        const åˆ— = pos % ç½‘æ ¼å¤§å°;

        // æ™®é€šç§»åŠ¨
        for (const { è¡Œå˜åŒ–, åˆ—å˜åŒ– } of æ–¹å‘) {
          const æ–°è¡Œ = è¡Œ + è¡Œå˜åŒ–;
          const æ–°åˆ— = åˆ— + åˆ—å˜åŒ–;
          if (this.æ˜¯å¦åˆæ³•ä½ç½®(æ–°è¡Œ, æ–°åˆ—) && this.ç½‘æ ¼[æ–°è¡Œ * ç½‘æ ¼å¤§å° + æ–°åˆ—] === null) {
            ç§»åŠ¨.push({ åˆ°: æ–°è¡Œ * ç½‘æ ¼å¤§å° + æ–°åˆ—, æ˜¯å¦åƒå­: false });
          }
        }

        // ç™½æ£‹åƒå­
        if (this.ç½‘æ ¼[pos] === ç™½æ£‹) {
          for (const { è¡Œå˜åŒ–, åˆ—å˜åŒ– } of æ–¹å‘) {
            const ä¸­é—´è¡Œ = è¡Œ + è¡Œå˜åŒ–;
            const ä¸­é—´åˆ— = åˆ— + åˆ—å˜åŒ–;
            const ç›®æ ‡è¡Œ = è¡Œ + 2 * è¡Œå˜åŒ–;
            const ç›®æ ‡åˆ— = åˆ— + 2 * åˆ—å˜åŒ–;
            if (
              this.æ˜¯å¦åˆæ³•ä½ç½®(ä¸­é—´è¡Œ, ä¸­é—´åˆ—) &&
              this.æ˜¯å¦åˆæ³•ä½ç½®(ç›®æ ‡è¡Œ, ç›®æ ‡åˆ—) &&
              this.ç½‘æ ¼[ä¸­é—´è¡Œ * ç½‘æ ¼å¤§å° + ä¸­é—´åˆ—] === null &&
              this.ç½‘æ ¼[ç›®æ ‡è¡Œ * ç½‘æ ¼å¤§å° + ç›®æ ‡åˆ—] === é»‘æ£‹
            ) {
              ç§»åŠ¨.push({ åˆ°: ç›®æ ‡è¡Œ * ç½‘æ ¼å¤§å° + ç›®æ ‡åˆ—, æ˜¯å¦åƒå­: true });
            }
          }
        }

        return ç§»åŠ¨;
      }

      æ˜¯å¦åˆæ³•ä½ç½®(è¡Œ, åˆ—) {
        return è¡Œ >= 0 && è¡Œ < ç½‘æ ¼å¤§å° && åˆ— >= 0 && åˆ— < ç½‘æ ¼å¤§å°;
      }

      ç§»åŠ¨æ£‹å­(ä», åˆ°) {
        if (!this.ç½‘æ ¼[ä»] || (this.ç½‘æ ¼[åˆ°] && this.ç½‘æ ¼[åˆ°] !== é»‘æ£‹)) {
          return null;
        }
        const æ£‹å­ = this.ç½‘æ ¼[ä»];
        this.ç½‘æ ¼[ä»] = null;
        const æ˜¯å¦åƒå­ = this.ç½‘æ ¼[åˆ°] === é»‘æ£‹;
        this.ç½‘æ ¼[åˆ°] = æ£‹å­;

        if (æ£‹å­ === ç™½æ£‹ && æ˜¯å¦åƒå­) {
          this.åƒæ‰é»‘æ£‹æ•°++;
        }

        this.å›åˆ = this.å›åˆ === é»‘æ£‹ ? ç™½æ£‹ : é»‘æ£‹;
        this.æœ€åç§»åŠ¨ = { ä», åˆ° };
        const å“ˆå¸Œ = this.è·å–å“ˆå¸Œ();
        this.å†å²å“ˆå¸Œ.push(å“ˆå¸Œ);
        this.å“ˆå¸Œè®¡æ•°.set(å“ˆå¸Œ, (this.å“ˆå¸Œè®¡æ•°.get(å“ˆå¸Œ) || 0) + 1);
        return { ä», åˆ°, æ˜¯å¦åƒå­ };
      }

      æ£€æŸ¥èƒœè´Ÿ() {
        if (this.åƒæ‰é»‘æ£‹æ•° >= 12) {
          return 'ç™½æ£‹è·èƒœï¼åƒæ‰12ä¸ªæˆ–æ›´å¤šé»‘æ£‹';
        }
        if (this.å›åˆ === ç™½æ£‹) {
          let æœ‰ç§»åŠ¨ = false;
          for (let i = 0; i < this.ç½‘æ ¼.length; i++) {
            if (this.ç½‘æ ¼[i] === ç™½æ£‹ && this.è·å–åˆæ³•ç§»åŠ¨(i).length > 0) {
              æœ‰ç§»åŠ¨ = true;
              break;
            }
          }
          if (!æœ‰ç§»åŠ¨) {
            return 'é»‘æ£‹è·èƒœï¼æ‰€æœ‰ç™½æ£‹è¢«å›°';
          }
        }
        if (this.å“ˆå¸Œè®¡æ•°.get(this.è·å–å“ˆå¸Œ()) >= 3) {
          return 'å¹³å±€ï¼å±€é¢ä¸‰æ¬¡é‡å¤';
        }
        return null;
      }

      å¤åˆ¶() {
        const æ–°æ£‹ç›˜ = new æ£‹ç›˜();
        æ–°æ£‹ç›˜.ç½‘æ ¼ = [...this.ç½‘æ ¼];
        æ–°æ£‹ç›˜.å›åˆ = this.å›åˆ;
        æ–°æ£‹ç›˜.åƒæ‰é»‘æ£‹æ•° = this.åƒæ‰é»‘æ£‹æ•°;
        æ–°æ£‹ç›˜.æœ€åç§»åŠ¨ = this.æœ€åç§»åŠ¨;
        æ–°æ£‹ç›˜.å†å²å“ˆå¸Œ = [...this.å†å²å“ˆå¸Œ];
        æ–°æ£‹ç›˜.å“ˆå¸Œè®¡æ•° = new Map(this.å“ˆå¸Œè®¡æ•°);
        return æ–°æ£‹ç›˜;
      }

      è·å–é»‘æ£‹æ•°é‡() {
        return this.ç½‘æ ¼.filter(æ£‹å­ => æ£‹å­ === é»‘æ£‹).length;
      }

      è·å–å“ˆå¸Œ() {
        return this.ç½‘æ ¼.join(',') + ',' + this.å›åˆ;
      }

      æ˜¯å¦å¯è¢«åƒ(pos) {
        const è¡Œ = Math.floor(pos / ç½‘æ ¼å¤§å°);
        const åˆ— = pos % ç½‘æ ¼å¤§å°;
        const æ–¹å‘ = [
          { è¡Œå˜åŒ–: -1, åˆ—å˜åŒ–: 0 }, // ä¸Š
          { è¡Œå˜åŒ–: 1, åˆ—å˜åŒ–: 0 },  // ä¸‹
          { è¡Œå˜åŒ–: 0, åˆ—å˜åŒ–: -1 }, // å·¦
          { è¡Œå˜åŒ–: 0, åˆ—å˜åŒ–: 1 }   // å³
        ];

        for (const { è¡Œå˜åŒ–, åˆ—å˜åŒ– } of æ–¹å‘) {
          const ç™½æ£‹è¡Œ = è¡Œ + 2 * è¡Œå˜åŒ–;
          const ç™½æ£‹åˆ— = åˆ— + 2 * åˆ—å˜åŒ–;
          const ä¸­é—´è¡Œ = è¡Œ + è¡Œå˜åŒ–;
          const ä¸­é—´åˆ— = åˆ— + åˆ—å˜åŒ–;
          if (
            this.æ˜¯å¦åˆæ³•ä½ç½®(ç™½æ£‹è¡Œ, ç™½æ£‹åˆ—) &&
            this.æ˜¯å¦åˆæ³•ä½ç½®(ä¸­é—´è¡Œ, ä¸­é—´åˆ—) &&
            this.ç½‘æ ¼[ç™½æ£‹è¡Œ * ç½‘æ ¼å¤§å° + ç™½æ£‹åˆ—] === ç™½æ£‹ &&
            this.ç½‘æ ¼[ä¸­é—´è¡Œ * ç½‘æ ¼å¤§å° + ä¸­é—´åˆ—] === null &&
            this.ç½‘æ ¼[pos] === é»‘æ£‹
          ) {
            return true;
          }
        }
        return false;
      }
    }

    class AI {
      constructor(æ£‹ç›˜) {
        this.æ£‹ç›˜ = æ£‹ç›˜;
        this.ä¸­å¿ƒæ ¼ = [12, 13, 17, 18];
        this.ç½®æ¢è¡¨ = new Map();
        this.ç½®æ¢è¡¨é¡ºåº = [];
      }

      è¯„ä¼°() {
        if (this.æ£‹ç›˜.åƒæ‰é»‘æ£‹æ•° >= 12) {
          return 10000;
        }
        if (this.æ£‹ç›˜.å“ˆå¸Œè®¡æ•°.get(this.æ£‹ç›˜.è·å–å“ˆå¸Œ()) >= 3) {
          return 0;
        }
        let ç™½æ£‹ç§»åŠ¨æ•° = 0;
        let ç™½æ£‹è¾¹ç¼˜å¾—åˆ† = 0;
        let ç™½æ£‹ä½ç½® = [];
        let é»‘æ£‹é è¿‘ç™½æ£‹å¾—åˆ† = 0;
        let ç™½æ£‹é è¿‘é»‘æ£‹å¾—åˆ† = 0;
        let é»‘æ£‹é›†ä¸­å¾—åˆ† = 0;
        let ä¸­å¿ƒæ§åˆ¶å¾—åˆ† = 0;
        let é»‘æ£‹ä½ç½® = [];
        let ç™½æ£‹å­¤ç«‹å¾—åˆ† = 0;
        let é»‘æ£‹å±é™©å¾—åˆ† = 0;

        for (let i = 0; i < this.æ£‹ç›˜.ç½‘æ ¼.length; i++) {
          if (this.æ£‹ç›˜.ç½‘æ ¼[i] === ç™½æ£‹) {
            ç™½æ£‹ç§»åŠ¨æ•° += this.æ£‹ç›˜.è·å–åˆæ³•ç§»åŠ¨(i).length;
            const è¡Œ = Math.floor(i / ç½‘æ ¼å¤§å°);
            const åˆ— = i % ç½‘æ ¼å¤§å°;
            ç™½æ£‹ä½ç½®.push({ è¡Œ, åˆ— });
            const è¾¹ç¼˜è·ç¦» = Math.min(è¡Œ, ç½‘æ ¼å¤§å° - 1 - è¡Œ, åˆ—, ç½‘æ ¼å¤§å° - 1 - åˆ—);
            ç™½æ£‹è¾¹ç¼˜å¾—åˆ† += è¾¹ç¼˜è·ç¦» === 0 ? 10 : è¾¹ç¼˜è·ç¦» === 1 ? 5 : 0;
            if (this.ä¸­å¿ƒæ ¼.includes(i)) ä¸­å¿ƒæ§åˆ¶å¾—åˆ† += 15;
          } else if (this.æ£‹ç›˜.ç½‘æ ¼[i] === é»‘æ£‹) {
            const è¡Œ = Math.floor(i / ç½‘æ ¼å¤§å°);
            const åˆ— = i % ç½‘æ ¼å¤§å°;
            é»‘æ£‹ä½ç½®.push({ è¡Œ, åˆ— });
            const ä¸­å¿ƒè·ç¦» = Math.min(
              Math.abs(è¡Œ - 2),
              Math.abs(åˆ— - 2)
            );
            é»‘æ£‹é›†ä¸­å¾—åˆ† += ä¸­å¿ƒè·ç¦» <= 2 ? 8 : 0;
            if (this.ä¸­å¿ƒæ ¼.includes(i)) ä¸­å¿ƒæ§åˆ¶å¾—åˆ† -= 15;
            if (this.æ£‹ç›˜.æ˜¯å¦å¯è¢«åƒ(i)) é»‘æ£‹å±é™©å¾—åˆ† -= 25;
          }
        }

        if (ç™½æ£‹ç§»åŠ¨æ•° === 0 && this.æ£‹ç›˜.å›åˆ === ç™½æ£‹) {
          return -10000;
        }

        for (const { è¡Œ, åˆ— } of é»‘æ£‹ä½ç½®) {
          let æœ€å°è·ç¦» = Infinity;
          for (const { è¡Œ: ç™½è¡Œ, åˆ—: ç™½åˆ— } of ç™½æ£‹ä½ç½®) {
            const è·ç¦» = Math.abs(è¡Œ - ç™½è¡Œ) + Math.abs(åˆ— - ç™½åˆ—);
            æœ€å°è·ç¦» = Math.min(æœ€å°è·ç¦», è·ç¦»);
          }
          é»‘æ£‹é è¿‘ç™½æ£‹å¾—åˆ† += æœ€å°è·ç¦» <= 2 ? 8 : 0;
        }
        for (const { è¡Œ, åˆ— } of ç™½æ£‹ä½ç½®) {
          let æœ€å°è·ç¦» = Infinity;
          for (const { è¡Œ: é»‘è¡Œ, åˆ—: é»‘åˆ— } of é»‘æ£‹ä½ç½®) {
            const è·ç¦» = Math.abs(è¡Œ - é»‘è¡Œ) + Math.abs(åˆ— - é»‘åˆ—);
            æœ€å°è·ç¦» = Math.min(æœ€å°è·ç¦», è·ç¦»);
          }
          ç™½æ£‹é è¿‘é»‘æ£‹å¾—åˆ† += æœ€å°è·ç¦» <= 2 ? 8 : 0;
        }

        for (const { è¡Œ, åˆ— } of ç™½æ£‹ä½ç½®) {
          let æœ€è¿‘ç™½æ£‹è·ç¦» = Infinity;
          for (const { è¡Œ: å…¶ä»–è¡Œ, åˆ—: å…¶ä»–åˆ— } of ç™½æ£‹ä½ç½®) {
            if (è¡Œ === å…¶ä»–è¡Œ && åˆ— === å…¶ä»–åˆ—) continue;
            const è·ç¦» = Math.abs(è¡Œ - å…¶ä»–è¡Œ) + Math.abs(åˆ— - å…¶ä»–åˆ—);
            æœ€è¿‘ç™½æ£‹è·ç¦» = Math.min(æœ€è¿‘ç™½æ£‹è·ç¦», è·ç¦»);
          }
          if (æœ€è¿‘ç™½æ£‹è·ç¦» > 2) ç™½æ£‹å­¤ç«‹å¾—åˆ† -= 10;
        }

        let é»‘æ£‹é›†ç¾¤å¾—åˆ† = 0;
        for (const { è¡Œ, åˆ— } of é»‘æ£‹ä½ç½®) {
          let é‚»å±…æ•° = 0;
          for (const { è¡Œ: å…¶ä»–è¡Œ, åˆ—: å…¶ä»–åˆ— } of é»‘æ£‹ä½ç½®) {
            if (Math.abs(è¡Œ - å…¶ä»–è¡Œ) + Math.abs(åˆ— - å…¶ä»–åˆ—) === 1) {
              é‚»å±…æ•°++;
            }
          }
          é»‘æ£‹é›†ç¾¤å¾—åˆ† += é‚»å±…æ•° * 8;
        }

        let é»‘æ£‹å°é”å¾—åˆ† = 0;
        for (const { è¡Œ, åˆ— } of é»‘æ£‹ä½ç½®) {
          for (const { è¡Œ: ç™½è¡Œ, åˆ—: ç™½åˆ— } of ç™½æ£‹ä½ç½®) {
            const ç™½æ£‹ä½ç½® = ç™½è¡Œ * ç½‘æ ¼å¤§å° + ç™½åˆ—;
            const ç§»åŠ¨ = this.æ£‹ç›˜.è·å–åˆæ³•ç§»åŠ¨(ç™½æ£‹ä½ç½®);
            for (const { åˆ° } of ç§»åŠ¨) {
              const åˆ°è¡Œ = Math.floor(åˆ° / ç½‘æ ¼å¤§å°);
              const åˆ°åˆ— = åˆ° % ç½‘æ ¼å¤§å°;
              if (Math.abs(è¡Œ - åˆ°è¡Œ) + Math.abs(åˆ— - åˆ°åˆ—) <= 1) {
                é»‘æ£‹å°é”å¾—åˆ† += 12;
              }
            }
          }
        }

        const é»‘æ£‹æ•° = this.æ£‹ç›˜.è·å–é»‘æ£‹æ•°é‡();
        const ç”Ÿå­˜å› å­ = é»‘æ£‹æ•° <= 5 ? 1.5 : é»‘æ£‹æ•° <= 10 ? 1.2 : 1.0;

        return this.æ£‹ç›˜.å›åˆ === ç™½æ£‹
          ? (this.æ£‹ç›˜.åƒæ‰é»‘æ£‹æ•° * 40 + ç™½æ£‹é è¿‘é»‘æ£‹å¾—åˆ† * 8 + ä¸­å¿ƒæ§åˆ¶å¾—åˆ† + ç™½æ£‹å­¤ç«‹å¾—åˆ†)
          : (-ç™½æ£‹ç§»åŠ¨æ•° * 25 * ç”Ÿå­˜å› å­ + ç™½æ£‹è¾¹ç¼˜å¾—åˆ† * 20 + é»‘æ£‹é è¿‘ç™½æ£‹å¾—åˆ† * 8 + é»‘æ£‹é›†ä¸­å¾—åˆ† * 8 + é»‘æ£‹é›†ç¾¤å¾—åˆ† + é»‘æ£‹å°é”å¾—åˆ† - ä¸­å¿ƒæ§åˆ¶å¾—åˆ† - é»‘æ£‹å±é™©å¾—åˆ† * ç”Ÿå­˜å› å­);
      }

      minimax(æ·±åº¦, alpha, beta, æ˜¯å¦æœ€å¤§åŒ–, æˆªæ­¢æ—¶é—´) {
        if (Date.now() > æˆªæ­¢æ—¶é—´) {
          return { åˆ†æ•°: this.è¯„ä¼°(), ç§»åŠ¨: null };
        }
        if (æ·±åº¦ === 0 || this.æ£‹ç›˜.æ£€æŸ¥èƒœè´Ÿ()) {
          return { åˆ†æ•°: this.è¯„ä¼°(), ç§»åŠ¨: null };
        }

        const å“ˆå¸Œ = this.æ£‹ç›˜.è·å–å“ˆå¸Œ();
        if (this.ç½®æ¢è¡¨.has(å“ˆå¸Œ)) {
          const ç¼“å­˜ = this.ç½®æ¢è¡¨.get(å“ˆå¸Œ);
          if (ç¼“å­˜.æ·±åº¦ >= æ·±åº¦) {
            return ç¼“å­˜;
          }
        }

        const å½“å‰æ£‹æ–¹ = this.æ£‹ç›˜.å›åˆ;
        let æœ€ä½³å¾—åˆ† = æ˜¯å¦æœ€å¤§åŒ– ? -Infinity : Infinity;
        let æœ€ä½³ç§»åŠ¨ = null;
        const ç§»åŠ¨åˆ—è¡¨ = [];

        for (let i = 0; i < this.æ£‹ç›˜.ç½‘æ ¼.length; i++) {
          if (this.æ£‹ç›˜.ç½‘æ ¼[i] === å½“å‰æ£‹æ–¹) {
            const ç§»åŠ¨ = this.æ£‹ç›˜.è·å–åˆæ³•ç§»åŠ¨(i);
            for (const { åˆ°, æ˜¯å¦åƒå­ } of ç§»åŠ¨) {
              ç§»åŠ¨åˆ—è¡¨.push({ ä»: i, åˆ°, æ˜¯å¦åƒå­ });
            }
          }
        }

        if (ç§»åŠ¨åˆ—è¡¨.length === 0) {
          return { åˆ†æ•°: this.è¯„ä¼°(), ç§»åŠ¨: null };
        }

        ç§»åŠ¨åˆ—è¡¨.sort((a, b) => {
          let aä¼˜å…ˆçº§ = 0;
          let bä¼˜å…ˆçº§ = 0;
          if (å½“å‰æ£‹æ–¹ === ç™½æ£‹) {
            aä¼˜å…ˆçº§ += a.æ˜¯å¦åƒå­ ? 100 : 0;
            bä¼˜å…ˆçº§ += b.æ˜¯å¦åƒå­ ? 100 : 0;
          } else {
            const æ–°æ£‹ç›˜A = this.æ£‹ç›˜.å¤åˆ¶();
            æ–°æ£‹ç›˜A.ç§»åŠ¨æ£‹å­(a.ä», a.åˆ°);
            const æ–°æ£‹ç›˜B = this.æ£‹ç›˜.å¤åˆ¶();
            æ–°æ£‹ç›˜B.ç§»åŠ¨æ£‹å­(b.ä», b.åˆ°);
            aä¼˜å…ˆçº§ -= æ–°æ£‹ç›˜A.æ˜¯å¦å¯è¢«åƒ(a.åˆ°) ? 60 : 0;
            bä¼˜å…ˆçº§ -= æ–°æ£‹ç›˜B.æ˜¯å¦å¯è¢«åƒ(b.åˆ°) ? 60 : 0;
            let ç™½æ£‹ç§»åŠ¨A = 0;
            let ç™½æ£‹ç§»åŠ¨B = 0;
            for (let i = 0; i < æ–°æ£‹ç›˜A.ç½‘æ ¼.length; i++) {
              if (æ–°æ£‹ç›˜A.ç½‘æ ¼[i] === ç™½æ£‹) ç™½æ£‹ç§»åŠ¨A += æ–°æ£‹ç›˜A.è·å–åˆæ³•ç§»åŠ¨(i).length;
              if (æ–°æ£‹ç›˜B.ç½‘æ ¼[i] === ç™½æ£‹) ç™½æ£‹ç§»åŠ¨B += æ–°æ£‹ç›˜B.è·å–åˆæ³•ç§»åŠ¨(i).length;
            }
            aä¼˜å…ˆçº§ -= ç™½æ£‹ç§»åŠ¨A * 12;
            bä¼˜å…ˆçº§ -= ç™½æ£‹ç§»åŠ¨B * 12;
          }
          const aè¡Œ = Math.floor(a.åˆ° / ç½‘æ ¼å¤§å°);
          const aåˆ— = a.åˆ° % ç½‘æ ¼å¤§å°;
          const bè¡Œ = Math.floor(b.åˆ° / ç½‘æ ¼å¤§å°);
          const båˆ— = b.åˆ° % ç½‘æ ¼å¤§å°;
          let aæœ€å°è·ç¦» = Infinity;
          let bæœ€å°è·ç¦» = Infinity;
          for (let i = 0; i < this.æ£‹ç›˜.ç½‘æ ¼.length; i++) {
            if (this.æ£‹ç›˜.ç½‘æ ¼[i] === (å½“å‰æ£‹æ–¹ === ç™½æ£‹ ? é»‘æ£‹ : ç™½æ£‹)) {
              const å¯¹æ‰‹è¡Œ = Math.floor(i / ç½‘æ ¼å¤§å°);
              const å¯¹æ‰‹åˆ— = i % ç½‘æ ¼å¤§å°;
              aæœ€å°è·ç¦» = Math.min(aæœ€å°è·ç¦», Math.abs(aè¡Œ - å¯¹æ‰‹è¡Œ) + Math.abs(aåˆ— - å¯¹æ‰‹åˆ—));
              bæœ€å°è·ç¦» = Math.min(bæœ€å°è·ç¦», Math.abs(bè¡Œ - å¯¹æ‰‹è¡Œ) + Math.abs(båˆ— - å¯¹æ‰‹åˆ—));
            }
          }
          aä¼˜å…ˆçº§ -= aæœ€å°è·ç¦» * 10;
          bä¼˜å…ˆçº§ -= bæœ€å°è·ç¦» * 10;
          if (this.ä¸­å¿ƒæ ¼.includes(a.åˆ°)) aä¼˜å…ˆçº§ += 20;
          if (this.ä¸­å¿ƒæ ¼.includes(b.åˆ°)) bä¼˜å…ˆçº§ += 20;
          return bä¼˜å…ˆçº§ - aä¼˜å…ˆçº§;
        });

        for (const { ä», åˆ° } of ç§»åŠ¨åˆ—è¡¨) {
          const æ–°æ£‹ç›˜ = this.æ£‹ç›˜.å¤åˆ¶();
          const ç»“æœ = æ–°æ£‹ç›˜.ç§»åŠ¨æ£‹å­(ä», åˆ°);
          if (!ç»“æœ) continue;
          const æ—§æ£‹ç›˜ = this.æ£‹ç›˜;
          this.æ£‹ç›˜ = æ–°æ£‹ç›˜;
          const { åˆ†æ•° } = this.minimax(æ·±åº¦ - 1, alpha, beta, !æ˜¯å¦æœ€å¤§åŒ–, æˆªæ­¢æ—¶é—´);
          this.æ£‹ç›˜ = æ—§æ£‹ç›˜;
          if (æ˜¯å¦æœ€å¤§åŒ–) {
            if (åˆ†æ•° > æœ€ä½³å¾—åˆ†) {
              æœ€ä½³å¾—åˆ† = åˆ†æ•°;
              æœ€ä½³ç§»åŠ¨ = { ä», åˆ° };
            }
            alpha = Math.max(alpha, æœ€ä½³å¾—åˆ†);
          } else {
            if (åˆ†æ•° < æœ€ä½³å¾—åˆ†) {
              æœ€ä½³å¾—åˆ† = åˆ†æ•°;
              æœ€ä½³ç§»åŠ¨ = { ä», åˆ° };
            }
            beta = Math.min(beta, æœ€ä½³å¾—åˆ†);
          }
          if (beta <= alpha) {
            break;
          }
        }

        const ç¼“å­˜ = { åˆ†æ•°: æœ€ä½³å¾—åˆ†, æ·±åº¦, ç§»åŠ¨: æœ€ä½³ç§»åŠ¨ };
        this.ç½®æ¢è¡¨.set(å“ˆå¸Œ, ç¼“å­˜);
        this.ç½®æ¢è¡¨é¡ºåº.push(å“ˆå¸Œ);
        if (this.ç½®æ¢è¡¨.size > 5000) {
          const æ—§å“ˆå¸Œ = this.ç½®æ¢è¡¨é¡ºåº.shift();
          this.ç½®æ¢è¡¨.delete(æ—§å“ˆå¸Œ);
        }

        return ç¼“å­˜;
      }

      è·å–æœ€ä½³ç§»åŠ¨() {
        const æˆªæ­¢æ—¶é—´ = Date.now() + 500;
        const æœ€å¤§æ·±åº¦ = this.æ£‹ç›˜.è·å–é»‘æ£‹æ•°é‡() <= 5 ? 5 : 4;
        let æœ€ä½³ç§»åŠ¨ = null;

        for (let æ·±åº¦ = 1; æ·±åº¦ <= æœ€å¤§æ·±åº¦; æ·±åº¦++) {
          this.å½“å‰æ·±åº¦ = æ·±åº¦;
          const ç»“æœ = this.minimax(æ·±åº¦, -Infinity, Infinity, this.æ£‹ç›˜.å›åˆ === ç™½æ£‹, æˆªæ­¢æ—¶é—´);
          if (ç»“æœ.ç§»åŠ¨ && Date.now() <= æˆªæ­¢æ—¶é—´) {
            æœ€ä½³ç§»åŠ¨ = ç»“æœ.ç§»åŠ¨;
          } else {
            break;
          }
        }

        if (!æœ€ä½³ç§»åŠ¨) {
          const ç§»åŠ¨åˆ—è¡¨ = [];
          for (let i = 0; i < this.æ£‹ç›˜.ç½‘æ ¼.length; i++) {
            if (this.æ£‹ç›˜.ç½‘æ ¼[i] === this.æ£‹ç›˜.å›åˆ) {
              const ç§»åŠ¨ = this.æ£‹ç›˜.è·å–åˆæ³•ç§»åŠ¨(i);
              for (const { åˆ°, æ˜¯å¦åƒå­ } of ç§»åŠ¨) {
                ç§»åŠ¨åˆ—è¡¨.push({ ä»: i, åˆ°, æ˜¯å¦åƒå­ });
              }
            }
          }
          if (ç§»åŠ¨åˆ—è¡¨.length > 0) {
            æœ€ä½³ç§»åŠ¨ = ç§»åŠ¨åˆ—è¡¨[Math.floor(Math.random() * ç§»åŠ¨åˆ—è¡¨.length)];
          }
        }

        if (this.ç½®æ¢è¡¨.size > 5000) {
          this.ç½®æ¢è¡¨é¡ºåº = this.ç½®æ¢è¡¨é¡ºåº.slice(-5000);
          const æ–°ç½®æ¢è¡¨ = new Map();
          for (const å“ˆå¸Œ of this.ç½®æ¢è¡¨é¡ºåº) {
            æ–°ç½®æ¢è¡¨.set(å“ˆå¸Œ, this.ç½®æ¢è¡¨.get(å“ˆå¸Œ));
          }
          this.ç½®æ¢è¡¨ = æ–°ç½®æ¢è¡¨;
        }

        return æœ€ä½³ç§»åŠ¨;
      }
    }

    class æ¸²æŸ“å™¨ {
      ç»˜åˆ¶æ£‹ç›˜(æ£‹ç›˜, èƒœè´ŸçŠ¶æ€ = null) {
        ä¸Šä¸‹æ–‡.clearRect(0, 0, ç”»å¸ƒ.width, ç”»å¸ƒ.height);

        if (!æ ¼å­å¤§å°) return; // é˜²æ­¢æ ¼å­å¤§å°æœªåˆå§‹åŒ–

        ä¸Šä¸‹æ–‡.strokeStyle = '#4B5EAA';
        ä¸Šä¸‹æ–‡.lineWidth = 2;
        for (let i = 0; i <= ç½‘æ ¼å¤§å°; i++) {
          ä¸Šä¸‹æ–‡.beginPath();
          ä¸Šä¸‹æ–‡.moveTo(i * æ ¼å­å¤§å°, 0);
          ä¸Šä¸‹æ–‡.lineTo(i * æ ¼å­å¤§å°, ç”»å¸ƒ.height / ä¸Šä¸‹æ–‡.getTransform().a);
          ä¸Šä¸‹æ–‡.stroke();
        }
        for (let i = 0; i <= ç½‘æ ¼å¤§å°; i++) {
          ä¸Šä¸‹æ–‡.beginPath();
          ä¸Šä¸‹æ–‡.moveTo(0, i * æ ¼å­å¤§å°);
          ä¸Šä¸‹æ–‡.lineTo(ç”»å¸ƒ.width / ä¸Šä¸‹æ–‡.getTransform().a, i * æ ¼å­å¤§å°);
          ä¸Šä¸‹æ–‡.stroke();
        }

        ä¸Šä¸‹æ–‡.fillStyle = '#666666';
        ä¸Šä¸‹æ–‡.font = `${æ ¼å­å¤§å° / 6}px Georgia`;
        ä¸Šä¸‹æ–‡.textAlign = 'right';
        ä¸Šä¸‹æ–‡.textBaseline = 'bottom';
        for (let i = 0; i < ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å°; i++) {
          const è¡Œ = Math.floor(i / ç½‘æ ¼å¤§å°);
          const åˆ— = i % ç½‘æ ¼å¤§å°;
          ä¸Šä¸‹æ–‡.fillText(i + 1, åˆ— * æ ¼å­å¤§å° + æ ¼å­å¤§å° - 5, è¡Œ * æ ¼å­å¤§å° + æ ¼å­å¤§å° - 5);
        }

        ä¸Šä¸‹æ–‡.shadowColor = 'rgba(0, 0, 0, 0.3)';
        ä¸Šä¸‹æ–‡.shadowBlur = ç”»å¸ƒ.width <= 300 ? 0 : 4;
        ä¸Šä¸‹æ–‡.shadowOffsetX = 3;
        ä¸Šä¸‹æ–‡.shadowOffsetY = 3;
        for (let i = 0; i < æ£‹ç›˜.ç½‘æ ¼.length; i++) {
          if (i < 0 || i >= ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å° || !æ£‹ç›˜.ç½‘æ ¼[i]) continue;
          const è¡Œ = Math.floor(i / ç½‘æ ¼å¤§å°);
          const åˆ— = i % ç½‘æ ¼å¤§å°;
          const x = åˆ— * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2;
          const y = è¡Œ * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2;
          let ç¼©æ”¾ = 1;
          let é€æ˜åº¦ = 1;
          let åç§»X = 0;
          if (èƒœè´ŸçŠ¶æ€ && èƒœè´ŸçŠ¶æ€.æ£‹å­.includes(i)) {
            if (èƒœè´ŸçŠ¶æ€.ç±»å‹ === 'èƒœåˆ©') {
              ç¼©æ”¾ = 1.5;
              é€æ˜åº¦ = 0.8;
            } else if (èƒœè´ŸçŠ¶æ€.ç±»å‹ === 'å¤±è´¥') {
              ç¼©æ”¾ = 0.8;
              åç§»X = Math.sin(Date.now() * 0.005) * 5;
            }
          }
          const æ£‹å­åŠå¾„ = æ ¼å­å¤§å° / (ç”»å¸ƒ.width <= 300 ? 2.73 : 3);
          if (!isFinite(x) || !isFinite(y) || !isFinite(æ ¼å­å¤§å°) || !isFinite(æ£‹å­åŠå¾„)) {
            console.warn(`è·³è¿‡æ£‹å­ç»˜åˆ¶ï¼šæ— æ•ˆå‚æ•° x=${x}, y=${y}, æ ¼å­å¤§å°=${æ ¼å­å¤§å°}, æ£‹å­åŠå¾„=${æ£‹å­åŠå¾„}`);
            continue;
          }
          ä¸Šä¸‹æ–‡.imageSmoothingEnabled = false;
          const æ¸å˜ = ä¸Šä¸‹æ–‡.createRadialGradient(x, y, æ ¼å­å¤§å° / 5, x, y, æ£‹å­åŠå¾„);
          if (æ£‹ç›˜.ç½‘æ ¼[i] === ç™½æ£‹) {
            æ¸å˜.addColorStop(0, `rgba(245, 245, 245, ${é€æ˜åº¦})`);
            æ¸å˜.addColorStop(1, `rgba(229, 231, 235, ${é€æ˜åº¦})`);
          } else {
            æ¸å˜.addColorStop(0, `rgba(51, 51, 51, ${é€æ˜åº¦})`);
            æ¸å˜.addColorStop(1, `rgba(31, 31, 31, ${é€æ˜åº¦})`);
          }
          ä¸Šä¸‹æ–‡.fillStyle = æ¸å˜;
          ä¸Šä¸‹æ–‡.beginPath();
          ä¸Šä¸‹æ–‡.arc(x + åç§»X, y, æ£‹å­åŠå¾„ * ç¼©æ”¾, 0, 2 * Math.PI);
          ä¸Šä¸‹æ–‡.fill();
          ä¸Šä¸‹æ–‡.strokeStyle = æ£‹ç›˜.ç½‘æ ¼[i] === ç™½æ£‹ ? '#000000' : '#D4D4D4';
          ä¸Šä¸‹æ–‡.lineWidth = 2;
          ä¸Šä¸‹æ–‡.stroke();

          ä¸Šä¸‹æ–‡.imageSmoothingEnabled = true;
          ä¸Šä¸‹æ–‡.fillStyle = æ£‹ç›˜.ç½‘æ ¼[i] === ç™½æ£‹ ? `rgba(0, 0, 0, ${é€æ˜åº¦})` : `rgba(212, 212, 212, ${é€æ˜åº¦})`;
          ä¸Šä¸‹æ–‡.font = `${æ ¼å­å¤§å° / 3}px 'PingFang SC', 'Arial', sans-serif`;
          ä¸Šä¸‹æ–‡.textAlign = 'center';
          ä¸Šä¸‹æ–‡.textBaseline = 'middle';
          ä¸Šä¸‹æ–‡.fillText(æ£‹ç›˜.ç½‘æ ¼[i] === ç™½æ£‹ ? 'ç‚®' : 'å…µ', x + åç§»X, y);
        }
        ä¸Šä¸‹æ–‡.shadowColor = 'transparent';

        if (æ£‹ç›˜.é€‰ä¸­æ£‹å­ !== null && æ£‹ç›˜.é€‰ä¸­æ£‹å­ >= 0 && æ£‹ç›˜.é€‰ä¸­æ£‹å­ < ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å°) {
          const è¡Œ = Math.floor(æ£‹ç›˜.é€‰ä¸­æ£‹å­ / ç½‘æ ¼å¤§å°);
          const åˆ— = æ£‹ç›˜.é€‰ä¸­æ£‹å­ % ç½‘æ ¼å¤§å°;
          ä¸Šä¸‹æ–‡.strokeStyle = '#FFFF00';
          ä¸Šä¸‹æ–‡.lineWidth = 5;
          ä¸Šä¸‹æ–‡.beginPath();
          ä¸Šä¸‹æ–‡.arc(
            åˆ— * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2,
            è¡Œ * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2,
            æ ¼å­å¤§å° / 3,
            0,
            2 * Math.PI
          );
          ä¸Šä¸‹æ–‡.stroke();

          ä¸Šä¸‹æ–‡.fillStyle = 'rgba(50, 205, 50, 0.4)';
          for (const { åˆ° } of æ£‹ç›˜.è·å–åˆæ³•ç§»åŠ¨(æ£‹ç›˜.é€‰ä¸­æ£‹å­)) {
            const ç§»åŠ¨è¡Œ = Math.floor(åˆ° / ç½‘æ ¼å¤§å°);
            const ç§»åŠ¨åˆ— = åˆ° % ç½‘æ ¼å¤§å°;
            ä¸Šä¸‹æ–‡.fillRect(ç§»åŠ¨åˆ— * æ ¼å­å¤§å°, ç§»åŠ¨è¡Œ * æ ¼å­å¤§å°, æ ¼å­å¤§å°, æ ¼å­å¤§å°);
          }
        }

        if (æ£‹ç›˜.æœ€åç§»åŠ¨) {
          const { ä», åˆ° } = æ£‹ç›˜.æœ€åç§»åŠ¨;
          if (ä» >= 0 && ä» < ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å° && åˆ° >= 0 && åˆ° < ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å°) {
            const ä»è¡Œ = Math.floor(ä» / ç½‘æ ¼å¤§å°);
            const ä»åˆ— = ä» % ç½‘æ ¼å¤§å°;
            const åˆ°è¡Œ = Math.floor(åˆ° / ç½‘æ ¼å¤§å°);
            const åˆ°åˆ— = åˆ° % ç½‘æ ¼å¤§å°;
            ä¸Šä¸‹æ–‡.strokeStyle = 'green';
            ä¸Šä¸‹æ–‡.lineWidth = 2;
            ä¸Šä¸‹æ–‡.setLineDash([5, 5]);
            ä¸Šä¸‹æ–‡.strokeRect(ä»åˆ— * æ ¼å­å¤§å°, ä»è¡Œ * æ ¼å­å¤§å°, æ ¼å­å¤§å°, æ ¼å­å¤§å°);
            ä¸Šä¸‹æ–‡.strokeRect(åˆ°åˆ— * æ ¼å­å¤§å°, åˆ°è¡Œ * æ ¼å­å¤§å°, æ ¼å­å¤§å°, æ ¼å­å¤§å°);
            ä¸Šä¸‹æ–‡.setLineDash([]);
          }
        }
      }

      åŠ¨ç”»ç§»åŠ¨(æ£‹ç›˜, ä», åˆ°, æ˜¯å¦åƒå­, å›è°ƒ) {
        const ä»è¡Œ = Math.floor(ä» / ç½‘æ ¼å¤§å°);
        const ä»åˆ— = ä» % ç½‘æ ¼å¤§å°;
        const åˆ°è¡Œ = Math.floor(åˆ° / ç½‘æ ¼å¤§å°);
        const åˆ°åˆ— = åˆ° % ç½‘æ ¼å¤§å°;
        if (
          ä» < 0 || ä» >= ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å° ||
          åˆ° < 0 || åˆ° >= ç½‘æ ¼å¤§å° * ç½‘æ ¼å¤§å° ||
          !isFinite(ä»è¡Œ) || !isFinite(ä»åˆ—) || !isFinite(åˆ°è¡Œ) || !isFinite(åˆ°åˆ—)
        ) {
          console.warn(`æ— æ•ˆç§»åŠ¨ï¼šä»=${ä»}, åˆ°=${åˆ°}`);
          å›è°ƒ();
          return;
        }
        let t = 0;
        const æŒç»­æ—¶é—´ = æ˜¯å¦åƒå­ ? 500 : 300;
        const å¼€å§‹X = ä»åˆ— * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2;
        const å¼€å§‹Y = ä»è¡Œ * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2;
        const ç»“æŸX = åˆ°åˆ— * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2;
        const ç»“æŸY = åˆ°è¡Œ * æ ¼å­å¤§å° + æ ¼å­å¤§å° / 2;

        const åŠ¨ç”» = () => {
          t = Math.min(t + 16 / æŒç»­æ—¶é—´, 1);
          if (t >= 1) {
            this.ç»˜åˆ¶æ£‹ç›˜(æ£‹ç›˜);
            æ’­æ”¾éŸ³æ•ˆ(æ˜¯å¦åƒå­ ? 440 : 300, æ˜¯å¦åƒå­ ? 440 : 300, æ˜¯å¦åƒå­ ? 0.1 : 0.05);
            å›è°ƒ();
            return;
          }

          this.ç»˜åˆ¶æ£‹ç›˜(æ£‹ç›˜);
          const x = å¼€å§‹X + (ç»“æŸX - å¼€å§‹X) * t;
          const y = å¼€å§‹Y + (ç»“æŸY - å¼€å§‹Y) * t;
          const ç¼©æ”¾ = æ˜¯å¦åƒå­
            ? (t < 0.5 ? 1 + 0.1 * t * 2 : 1.1 - 0.1 * (t - 0.5) * 2)
            : (t < 0.5 ? 1 + 0.05 * t * 2 : 1.05 - 0.05 * (t - 0.5) * 2);
          const æ£‹å­åŠå¾„ = æ ¼å­å¤§å° / (ç”»å¸ƒ.width <= 300 ? 2.73 : 3);
          if (!isFinite(x) || !isFinite(y) || !isFinite(æ ¼å­å¤§å°) || !isFinite(æ£‹å­åŠå¾„)) {
            console.warn(`è·³è¿‡åŠ¨ç”»æ£‹å­ç»˜åˆ¶ï¼šæ— æ•ˆå‚æ•° x=${x}, y=${y}, æ ¼å­å¤§å°=${æ ¼å­å¤§å°}, æ£‹å­åŠå¾„=${æ£‹å­åŠå¾„}`);
            requestAnimationFrame(åŠ¨ç”»);
            return;
          }
          ä¸Šä¸‹æ–‡.imageSmoothingEnabled = false;
          const æ¸å˜ = ä¸Šä¸‹æ–‡.createRadialGradient(x, y, æ ¼å­å¤§å° / 5, x, y, æ£‹å­åŠå¾„);
          const æ£‹å­é¢œè‰² = æ£‹ç›˜.ç½‘æ ¼[åˆ°] || æ£‹ç›˜.ç½‘æ ¼[ä»];
          if (æ£‹å­é¢œè‰² === ç™½æ£‹) {
            æ¸å˜.addColorStop(0, '#F5F5F5');
            æ¸å˜.addColorStop(1, '#E5E7EB');
          } else {
            æ¸å˜.addColorStop(0, '#333333');
            æ¸å˜.addColorStop(1, '#1F1F1F');
          }
          ä¸Šä¸‹æ–‡.fillStyle = æ¸å˜;
          ä¸Šä¸‹æ–‡.shadowColor = 'rgba(0, 0, 0, 0.3)';
          ä¸Šä¸‹æ–‡.shadowBlur = ç”»å¸ƒ.width <= 300 ? 0 : 4;
          ä¸Šä¸‹æ–‡.shadowOffsetX = 3;
          ä¸Šä¸‹æ–‡.shadowOffsetY = 3;
          ä¸Šä¸‹æ–‡.beginPath();
          ä¸Šä¸‹æ–‡.arc(x, y, æ£‹å­åŠå¾„ * ç¼©æ”¾, 0, 2 * Math.PI);
          ä¸Šä¸‹æ–‡.fill();
          ä¸Šä¸‹æ–‡.strokeStyle = æ£‹å­é¢œè‰² === ç™½æ£‹ ? '#000000' : '#D4D4D4';
          ä¸Šä¸‹æ–‡.lineWidth = 2;
          ä¸Šä¸‹æ–‡.stroke();

          ä¸Šä¸‹æ–‡.imageSmoothingEnabled = true;
          ä¸Šä¸‹æ–‡.fillStyle = æ£‹å­é¢œè‰² === ç™½æ£‹ ? '#000000' : '#D4D4D4';
          ä¸Šä¸‹æ–‡.font = `${æ ¼å­å¤§å° / 3}px 'PingFang SC', 'Arial', sans-serif`;
          ä¸Šä¸‹æ–‡.textAlign = 'center';
          ä¸Šä¸‹æ–‡.textBaseline = 'middle';
          ä¸Šä¸‹æ–‡.fillText(æ£‹å­é¢œè‰² === ç™½æ£‹ ? 'ç‚®' : 'å…µ', x, y);

          ä¸Šä¸‹æ–‡.shadowColor = 'transparent';
          requestAnimationFrame(åŠ¨ç”»);
        };

        requestAnimationFrame(åŠ¨ç”»);
      }

      èƒœè´ŸåŠ¨ç”»(æ£‹ç›˜, èƒœæ–¹, å›è°ƒ) {
        const èƒœæ£‹å­ = [];
        const è´¥æ£‹å­ = [];
        for (let i = 0; i < æ£‹ç›˜.ç½‘æ ¼.length; i++) {
          if (æ£‹ç›˜.ç½‘æ ¼[i] === èƒœæ–¹) {
            èƒœæ£‹å­.push(i);
          } else if (æ£‹ç›˜.ç½‘æ ¼[i]) {
            è´¥æ£‹å­.push(i);
          }
        }
        let t = 0;
        const æŒç»­æ—¶é—´ = 500;

        const åŠ¨ç”» = () => {
          t = Math.min(t + 16 / æŒç»­æ—¶é—´, 1);
          if (t >= 1) {
            this.ç»˜åˆ¶æ£‹ç›˜(æ£‹ç›˜, { ç±»å‹: 'èƒœåˆ©', æ£‹å­: èƒœæ£‹å­ });
            å›è°ƒ();
            return;
          }
          this.ç»˜åˆ¶æ£‹ç›˜(æ£‹ç›˜, { ç±»å‹: t < 0.5 ? 'èƒœåˆ©' : 'å¤±è´¥', æ£‹å­: t < 0.5 ? èƒœæ£‹å­ : è´¥æ£‹å­ });
          requestAnimationFrame(åŠ¨ç”»);
        };

        requestAnimationFrame(åŠ¨ç”»);
      }
    }

    class æ¸¸æˆ {
      constructor() {
        this.æ£‹ç›˜ = new æ£‹ç›˜();
        this.æ¸²æŸ“å™¨ = new æ¸²æŸ“å™¨();
        this.AI = new AI(this.æ£‹ç›˜);
        this.ç©å®¶æ£‹æ–¹ = null;
        this.å¯¹æˆ˜æ¨¡å¼ = null;
        this.AIç§»åŠ¨ä¸­ = false;
        this.æ£‹ç›˜.åˆå§‹åŒ–();
        this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
        this.æ›´æ–°çŠ¶æ€();
      }

      æ›´æ–°çŠ¶æ€() {
        if (this.å¯¹æˆ˜æ¨¡å¼ === null) {
          çŠ¶æ€.textContent = 'è¯·é€‰æ‹©å¯¹æˆ˜æ¨¡å¼';
          çŠ¶æ€.className = '';
        } else if (this.AIç§»åŠ¨ä¸­) {
          çŠ¶æ€.textContent = `AIæ€è€ƒä¸­...`;
          çŠ¶æ€.className = 'AIæ€è€ƒä¸­';
        } else {
          const ç»“æœ = this.æ£‹ç›˜.æ£€æŸ¥èƒœè´Ÿ();
          if (ç»“æœ) {
            const æ˜¯èƒœåˆ© = (this.å¯¹æˆ˜æ¨¡å¼ === 'äººæœº' && 
              ((this.ç©å®¶æ£‹æ–¹ === ç™½æ£‹ && ç»“æœ.includes('ç™½æ£‹è·èƒœ')) || 
               (this.ç©å®¶æ£‹æ–¹ === é»‘æ£‹ && ç»“æœ.includes('é»‘æ£‹è·èƒœ')))) ||
              (this.å¯¹æˆ˜æ¨¡å¼ === 'åŒäºº' && ç»“æœ.includes('è·èƒœ')) ||
              ç»“æœ.includes('å¹³å±€');
            çŠ¶æ€.textContent = ç»“æœ;
            çŠ¶æ€.className = æ˜¯èƒœåˆ© ? 'èƒœè´Ÿæç¤º-èƒœåˆ©' : 'èƒœè´Ÿæç¤º-å¤±è´¥';
            this.æ˜¾ç¤ºèƒœè´Ÿæ¨¡æ€(ç»“æœ, æ˜¯èƒœåˆ©);
          } else if (this.å¯¹æˆ˜æ¨¡å¼ === 'äººæœº') {
            çŠ¶æ€.textContent = `æ‚¨æ‰§${this.ç©å®¶æ£‹æ–¹ === ç™½æ£‹ ? 'ç™½æ£‹' : 'é»‘æ£‹'} | è½®åˆ°ï¼š${this.æ£‹ç›˜.å›åˆ === ç™½æ£‹ ? 'ç™½æ£‹' : 'é»‘æ£‹'} | åƒæ‰é»‘æ£‹æ•°ï¼š${this.æ£‹ç›˜.åƒæ‰é»‘æ£‹æ•°}`;
            çŠ¶æ€.className = `å›åˆ-${this.æ£‹ç›˜.å›åˆ === ç™½æ£‹ ? 'ç™½æ£‹' : 'é»‘æ£‹'}`;
          } else {
            çŠ¶æ€.textContent = `è½®åˆ°ï¼š${this.æ£‹ç›˜.å›åˆ === ç™½æ£‹ ? 'ç™½æ£‹' : 'é»‘æ£‹'} | åƒæ‰é»‘æ£‹æ•°ï¼š${this.æ£‹ç›˜.åƒæ‰é»‘æ£‹æ•°}`;
            çŠ¶æ€.className = `å›åˆ-${this.æ£‹ç›˜.å›åˆ === ç™½æ£‹ ? 'ç™½æ£‹' : 'é»‘æ£‹'}`;
          }
        }
      }

      æ˜¾ç¤ºèƒœè´Ÿæ¨¡æ€(ç»“æœ, æ˜¯èƒœåˆ©) {
        èƒœè´Ÿæ–‡æœ¬.textContent = (æ˜¯èƒœåˆ© && ç»“æœ.includes('è·èƒœ') ? 'ğŸª™ ' : ç»“æœ.includes('å¹³å±€') ? '' : 'â— ') + ç»“æœ;
        èƒœè´Ÿæ–‡æœ¬.className = æ˜¯èƒœåˆ© ? 'èƒœåˆ©' : 'å¤±è´¥';
        èƒœè´Ÿå®¹å™¨.className = æ˜¯èƒœåˆ© ? 'èƒœåˆ©' : 'å¤±è´¥';
        èƒœè´Ÿæ¨¡æ€.classList.add('æ˜¾ç¤º');
        ç”»å¸ƒ.classList.add(æ˜¯èƒœåˆ© ? 'æ£‹ç›˜-èƒœåˆ©' : 'æ£‹ç›˜-å¤±è´¥');
        const èƒœæ–¹ = ç»“æœ.includes('ç™½æ£‹è·èƒœ') ? ç™½æ£‹ : ç»“æœ.includes('é»‘æ£‹è·èƒœ') ? é»‘æ£‹ : null;
        æ’­æ”¾éŸ³æ•ˆ(æ˜¯èƒœåˆ© ? 600 : 200, æ˜¯èƒœåˆ© ? 800 : 100, 0.6, 0.7);
        if (èƒœæ–¹) {
          this.æ¸²æŸ“å™¨.èƒœè´ŸåŠ¨ç”»(this.æ£‹ç›˜, èƒœæ–¹, () => {
            this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
          });
        }
        ç”»å¸ƒ.removeEventListener('click', this.ç‚¹å‡»å¤„ç†å™¨);
        äººæœºç™½æ£‹æŒ‰é’®.disabled = true;
        äººæœºé»‘æ£‹æŒ‰é’®.disabled = true;
        åŒäººå¯¹æˆ˜æŒ‰é’®.disabled = true;
        é‡ç½®æŒ‰é’®.disabled = true;
      }

      é€‰æ‹©æ£‹æ–¹(æ£‹æ–¹, æ¨¡å¼) {
        this.å¯¹æˆ˜æ¨¡å¼ = æ¨¡å¼;
        this.ç©å®¶æ£‹æ–¹ = æ¨¡å¼ === 'äººæœº' ? æ£‹æ–¹ : null;
        äººæœºç™½æ£‹æŒ‰é’®.disabled = true;
        äººæœºé»‘æ£‹æŒ‰é’®.disabled = true;
        åŒäººå¯¹æˆ˜æŒ‰é’®.disabled = true;
        é‡ç½®æŒ‰é’®.disabled = false;
        this.AIç§»åŠ¨ä¸­ = false;
        this.æ£‹ç›˜.åˆå§‹åŒ–();
        this.AI = new AI(this.æ£‹ç›˜);
        this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
        this.æ›´æ–°çŠ¶æ€();
        if (this.å¯¹æˆ˜æ¨¡å¼ === 'äººæœº' && this.æ£‹ç›˜.å›åˆ !== this.ç©å®¶æ£‹æ–¹) {
          this.AIç§»åŠ¨();
        }
      }

      AIç§»åŠ¨() {
        if (this.AIç§»åŠ¨ä¸­ || this.å¯¹æˆ˜æ¨¡å¼ !== 'äººæœº') return;
        this.AIç§»åŠ¨ä¸­ = true;
        this.æ›´æ–°çŠ¶æ€();
        const ç§»åŠ¨ = this.AI.è·å–æœ€ä½³ç§»åŠ¨();
        if (ç§»åŠ¨ && ç§»åŠ¨.ä» !== undefined && ç§»åŠ¨.åˆ° !== undefined) {
          setTimeout(() => {
            this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = ç§»åŠ¨.ä»;
            this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
            setTimeout(() => {
              const ç»“æœ = this.æ£‹ç›˜.ç§»åŠ¨æ£‹å­(ç§»åŠ¨.ä», ç§»åŠ¨.åˆ°);
              if (ç»“æœ) {
                const { ä», åˆ°, æ˜¯å¦åƒå­ } = ç»“æœ;
                this.æ¸²æŸ“å™¨.åŠ¨ç”»ç§»åŠ¨(this.æ£‹ç›˜, ä», åˆ°, æ˜¯å¦åƒå­, () => {
                  this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = null;
                  const ç»“æœ = this.æ£‹ç›˜.æ£€æŸ¥èƒœè´Ÿ();
                  this.AIç§»åŠ¨ä¸­ = false;
                  if (ç»“æœ) {
                    this.æ›´æ–°çŠ¶æ€();
                  } else {
                    this.æ›´æ–°çŠ¶æ€();
                    if (this.å¯¹æˆ˜æ¨¡å¼ === 'äººæœº' && this.æ£‹ç›˜.å›åˆ !== this.ç©å®¶æ£‹æ–¹) {
                      this.AIç§»åŠ¨();
                    }
                  }
                  this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
                });
              } else {
                this.AIç§»åŠ¨ä¸­ = false;
                this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = null;
                this.æ›´æ–°çŠ¶æ€();
                this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
              }
            }, 600);
          }, 600);
        } else {
          this.AIç§»åŠ¨ä¸­ = false;
          this.æ›´æ–°çŠ¶æ€();
          this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
        }
      }

      å¤„ç†ç‚¹å‡»(x, y) {
        if (this.å¯¹æˆ˜æ¨¡å¼ === null || this.AIç§»åŠ¨ä¸­) return;
        if (this.å¯¹æˆ˜æ¨¡å¼ === 'äººæœº' && this.æ£‹ç›˜.å›åˆ !== this.ç©å®¶æ£‹æ–¹) return;

        const è¡Œ = Math.floor(y / æ ¼å­å¤§å°);
        const åˆ— = Math.floor(x / æ ¼å­å¤§å°);
        const ä½ç½® = è¡Œ * ç½‘æ ¼å¤§å° + åˆ—;

        if (this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ === null) {
          if (this.æ£‹ç›˜.ç½‘æ ¼[ä½ç½®] === this.æ£‹ç›˜.å›åˆ) {
            this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = ä½ç½®;
            this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
          }
        } else {
          const ç§»åŠ¨ = this.æ£‹ç›˜.è·å–åˆæ³•ç§»åŠ¨(this.æ£‹ç›˜.é€‰ä¸­æ£‹å­);
          if (ç§»åŠ¨.some(m => m.åˆ° === ä½ç½®)) {
            const ç»“æœ = this.æ£‹ç›˜.ç§»åŠ¨æ£‹å­(this.æ£‹ç›˜.é€‰ä¸­æ£‹å­, ä½ç½®);
            if (ç»“æœ) {
              const { ä», åˆ°, æ˜¯å¦åƒå­ } = ç»“æœ;
              this.æ¸²æŸ“å™¨.åŠ¨ç”»ç§»åŠ¨(this.æ£‹ç›˜, ä», åˆ°, æ˜¯å¦åƒå­, () => {
                this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = null;
                const ç»“æœ = this.æ£‹ç›˜.æ£€æŸ¥èƒœè´Ÿ();
                if (ç»“æœ) {
                  this.æ›´æ–°çŠ¶æ€();
                } else {
                  this.æ›´æ–°çŠ¶æ€();
                  if (this.å¯¹æˆ˜æ¨¡å¼ === 'äººæœº' && this.æ£‹ç›˜.å›åˆ !== this.ç©å®¶æ£‹æ–¹) {
                    this.AIç§»åŠ¨();
                  }
                }
                this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
              });
            } else {
              this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = null;
              this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
            }
          } else {
            this.æ£‹ç›˜.é€‰ä¸­æ£‹å­ = null;
            this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
          }
        }
      }

      é‡ç½®() {
        this.ç©å®¶æ£‹æ–¹ = null;
        this.å¯¹æˆ˜æ¨¡å¼ = null;
        this.AIç§»åŠ¨ä¸­ = false;
        äººæœºç™½æ£‹æŒ‰é’®.disabled = false;
        äººæœºé»‘æ£‹æŒ‰é’®.disabled = false;
        åŒäººå¯¹æˆ˜æŒ‰é’®.disabled = false;
        é‡ç½®æŒ‰é’®.disabled = false;
        this.æ£‹ç›˜.åˆå§‹åŒ–();
        this.AI = new AI(this.æ£‹ç›˜);
        ç”»å¸ƒ.addEventListener('click', this.ç‚¹å‡»å¤„ç†å™¨);
        èƒœè´Ÿæ¨¡æ€.classList.remove('æ˜¾ç¤º');
        ç”»å¸ƒ.classList.remove('æ£‹ç›˜-èƒœåˆ©', 'æ£‹ç›˜-å¤±è´¥');
        this.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(this.æ£‹ç›˜);
        this.æ›´æ–°çŠ¶æ€();
      }
    }

    const æ¸¸æˆå®ä¾‹ = new æ¸¸æˆ();
    æ¸¸æˆå®ä¾‹.ç‚¹å‡»å¤„ç†å™¨ = (e) => {
      const çŸ©å½¢ = ç”»å¸ƒ.getBoundingClientRect();
      const x = (e.clientX - çŸ©å½¢.left) * (ç”»å¸ƒ.width / çŸ©å½¢.width);
      const y = (e.clientY - çŸ©å½¢.top) * (ç”»å¸ƒ.height / çŸ©å½¢.height);
      æ¸¸æˆå®ä¾‹.å¤„ç†ç‚¹å‡»(x / ä¸Šä¸‹æ–‡.getTransform().a, y / ä¸Šä¸‹æ–‡.getTransform().a);
    };
    ç”»å¸ƒ.addEventListener('click', æ¸¸æˆå®ä¾‹.ç‚¹å‡»å¤„ç†å™¨);
    é‡ç½®æŒ‰é’®.addEventListener('click', () => æ¸¸æˆå®ä¾‹.é‡ç½®());
    äººæœºç™½æ£‹æŒ‰é’®.addEventListener('click', () => æ¸¸æˆå®ä¾‹.é€‰æ‹©æ£‹æ–¹(ç™½æ£‹, 'äººæœº'));
    äººæœºé»‘æ£‹æŒ‰é’®.addEventListener('click', () => æ¸¸æˆå®ä¾‹.é€‰æ‹©æ£‹æ–¹(é»‘æ£‹, 'äººæœº'));
    åŒäººå¯¹æˆ˜æŒ‰é’®.addEventListener('click', () => æ¸¸æˆå®ä¾‹.é€‰æ‹©æ£‹æ–¹(null, 'åŒäºº'));
    é‡ç©æŒ‰é’®.addEventListener('click', () => æ¸¸æˆå®ä¾‹.é‡ç½®());
    èƒœè´Ÿæ¨¡æ€.addEventListener('click', (e) => {
      if (e.target === èƒœè´Ÿæ¨¡æ€) æ¸¸æˆå®ä¾‹.é‡ç½®();
    });

    function è°ƒæ•´ç”»å¸ƒå¤§å°() {
      let ç”»å¸ƒå®½åº¦, ç”»å¸ƒé«˜åº¦;
      if (window.innerWidth < 600) {
        ç”»å¸ƒå®½åº¦ = 300;
        ç”»å¸ƒé«˜åº¦ = 300;
      } else if (window.innerWidth < 800) {
        ç”»å¸ƒå®½åº¦ = 400;
        ç”»å¸ƒé«˜åº¦ = 400;
      } else {
        ç”»å¸ƒå®½åº¦ = 500;
        ç”»å¸ƒé«˜åº¦ = 500;
      }
      const DPR = Math.min(window.devicePixelRatio || 1, 2);
      ç”»å¸ƒ.width = ç”»å¸ƒå®½åº¦ * DPR;
      ç”»å¸ƒ.height = ç”»å¸ƒé«˜åº¦ * DPR;
      ç”»å¸ƒ.style.width = `${ç”»å¸ƒå®½åº¦}px`;
      ç”»å¸ƒ.style.height = `${ç”»å¸ƒé«˜åº¦}px`;
      ä¸Šä¸‹æ–‡.scale(DPR, DPR);
      æ ¼å­å¤§å° = ç”»å¸ƒå®½åº¦ / ç½‘æ ¼å¤§å°;
      æ¸¸æˆå®ä¾‹.æ¸²æŸ“å™¨.ç»˜åˆ¶æ£‹ç›˜(æ¸¸æˆå®ä¾‹.æ£‹ç›˜);
    }
    è°ƒæ•´ç”»å¸ƒå¤§å°(); // ç«‹å³è°ƒç”¨
    window.addEventListener('resize', è°ƒæ•´ç”»å¸ƒå¤§å°);
  </script>
</body>
</html>